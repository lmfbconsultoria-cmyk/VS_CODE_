<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ACI 318 Concrete Beam Checker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script>
        (function() {
            const isDark = localStorage.getItem('color-theme') === 'dark' || (!('color-theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches);
            document.documentElement.classList.toggle('dark', isDark);
        })();
    </script>
    <link rel="stylesheet" href="../styles.min.css">
    <script src="../shared-utils.js" defer></script>
</head>
<body class="bg-gray-50 dark:bg-gray-900">
    <div class="container mx-auto p-4 md:p-8 max-w-7xl">
        <header class="text-center mb-8 relative">
            <h1 class="text-3xl md:text-4xl font-bold">ACI 318-19 Concrete Beam Checker</h1>
            <p class="text-lg mt-2">Flexure and shear design check for rectangular concrete beams.</p>
            <button id="theme-toggle" type="button" class="text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg text-sm p-2.5 absolute top-0 right-0">
                </button>
        </header>

        <main id="aci-form">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <div>
                    <div class="form-section">
                        <h2>Material Properties</h2>
                        <div class="space-y-4">
                            <div>
                                <label for="fc" class="block text-sm font-medium mb-1">Concrete Strength (f'c, psi)</label>
                                <input type="number" id="fc" value="4000">
                            </div>
                            <div>
                                <label for="fy" class="block text-sm font-medium mb-1">Steel Yield Strength (fy, psi)</label>
                                <input type="number" id="fy" value="60000">
                            </div>
                        </div>
                    </div>
                    <div class="form-section">
                        <h2>Beam Geometry</h2>
                        <div class="grid grid-cols-2 gap-4">
                            <div><label for="b" class="block text-sm">Width (b, in)</label><input type="number" id="b" value="12"></div>
                            <div><label for="h" class="block text-sm">Height (h, in)</label><input type="number" id="h" value="24"></div>
                            <div><label for="cover" class="block text-sm">Cover (in)</label><input type="number" id="cover" value="1.5"></div>
                        </div>
                    </div>
                </div>

                <div>
                    <div class="form-section">
                        <h2>Flexural Reinforcement</h2>
                        <div class="grid grid-cols-2 gap-4">
                            <div><label for="num_bars" class="block text-sm">No. of Bars</label><input type="number" id="num_bars" value="3"></div>
                            <div><label for="bar_size" class="block text-sm">Bar Size (#)</label><input type="number" id="bar_size" value="8"></div>
                        </div>
                    </div>
                    <div class="form-section">
                        <h2>Shear Reinforcement</h2>
                        <div class="grid grid-cols-2 gap-4">
                            <div><label for="stirrup_size" class="block text-sm">Stirrup Size (#)</label><input type="number" id="stirrup_size" value="3"></div>
                            <div><label for="stirrup_legs" class="block text-sm">No. of Legs</label><input type="number" id="stirrup_legs" value="2"></div>
                            <div><label for="stirrup_spacing" class="block text-sm">Spacing (s, in)</label><input type="number" id="stirrup_spacing" value="10"></div>
                        </div>
                    </div>
                    <div class="form-section">
                        <h2>Factored Loads (LRFD)</h2>
                        <div class="space-y-4">
                            <div>
                                <label for="Mu" class="block text-sm font-medium mb-1">Moment (M<sub>u</sub>, kip-ft)</label>
                                <input type="number" id="Mu" value="150">
                            </div>
                            <div>
                                <label for="Vu" class="block text-sm font-medium mb-1">Shear (V<sub>u</sub>, kips)</label>
                                <input type="number" id="Vu" value="30">
                            </div>
                        </div>
                    </div>
                </div>

                <div class="lg:col-span-1">
                    <div class="form-section">
                        <h2>Summary of Results</h2>
                        <div id="summary-results" class="space-y-3">
                            <p class="text-center text-gray-500">Click "Run Check" to see results.</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="mt-8 flex justify-center">
                <button id="run-check-btn" class="bg-blue-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-blue-700">Run Check</button>
            </div>
        </main>

        <div id="results-container" class="mt-10 results-container"></div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        document.getElementById('run-check-btn').addEventListener('click', runAciCheck);
        initializeTheme();
    });

    const BAR_AREAS = { 3: 0.11, 4: 0.20, 5: 0.31, 6: 0.44, 7: 0.60, 8: 0.79, 9: 1.00, 10: 1.27, 11: 1.56 };

    function runAciCheck() {
        const getVal = (id) => parseFloat(document.getElementById(id).value) || 0;
        const inputs = {
            fc: getVal('fc'), fy: getVal('fy'), b: getVal('b'), h: getVal('h'), cover: getVal('cover'),
            num_bars: getVal('num_bars'), bar_size: getVal('bar_size'),
            stirrup_size: getVal('stirrup_size'), stirrup_legs: getVal('stirrup_legs'), stirrup_spacing: getVal('stirrup_spacing'),
            Mu: getVal('Mu') * 12000, Vu: getVal('Vu') * 1000
        };
        const results = calculateAci318(inputs);
        renderAciResults(inputs, results);
    }

    function calculateAci318(i) {
        const res = {};
        const Es = 29000000; // psi

        // Flexure
        const d = i.h - i.cover - (BAR_AREAS[i.stirrup_size] ? i.stirrup_size/16 : 0) - (BAR_AREAS[i.bar_size] ? i.bar_size/16 : 0);
        const As = i.num_bars * (BAR_AREAS[i.bar_size] || 0);
        const beta1 = Math.max(0.65, Math.min(0.85, 0.85 - 0.05 * ((i.fc - 4000) / 1000)));
        const a = (As * i.fy) / (0.85 * i.fc * i.b);
        const c = a / beta1;
        const strain_t = (d - c) / c * 0.003;
        const phi_f = strain_t >= 0.005 ? 0.90 : (strain_t > (i.fy / Es) ? 0.65 + 0.25 * ((strain_t - (i.fy / Es)) / (0.005 - (i.fy / Es))) : 0.65);
        const Mn = As * i.fy * (d - a / 2);
        res.phiMn = phi_f * Mn;
        res.d = d; res.As = As; res.a = a; res.c = c; res.strain_t = strain_t; res.phi_f = phi_f;
        
        // Shear
        const Av = i.stirrup_legs * (BAR_AREAS[i.stirrup_size] || 0);
        const Vc = 2 * Math.sqrt(i.fc) * i.b * d;
        const Vs = (Av * i.fy * d) / i.stirrup_spacing;
        const Vs_max = 8 * Math.sqrt(i.fc) * i.b * d;
        const phi_v = 0.75;
        res.phiVn = phi_v * (Vc + Math.min(Vs, Vs_max));
        res.Vc = Vc; res.Vs = Vs; res.Vs_max = Vs_max; res.Av = Av;

        return res;
    }

    function renderAciResults(inputs, results) {
        const summaryContainer = document.getElementById('summary-results');
        const resultsContainer = document.getElementById('results-container');
        
        const M_ratio = results.phiMn > 0 ? inputs.Mu / results.phiMn : Infinity;
        const V_ratio = results.phiVn > 0 ? inputs.Vu / results.phiVn : Infinity;
        const getStatus = (ratio) => ratio <= 1.0 ? `<span class="pass">OK</span>` : `<span class="fail">FAIL</span>`;

        summaryContainer.innerHTML = `
            <div class="p-2 bg-gray-100 dark:bg-gray-700 rounded-md">
                <p class="flex justify-between"><span>Flexure (M<sub>u</sub> / &phi;M<sub>n</sub>):</span> <strong class="${M_ratio <= 1.0 ? 'text-green-600' : 'text-red-600'}">${M_ratio.toFixed(3)}</strong></p>
            </div>
            <div class="p-2 bg-gray-100 dark:bg-gray-700 rounded-md">
                <p class="flex justify-between"><span>Shear (V<sub>u</sub> / &phi;V<sub>n</sub>):</span> <strong class="${V_ratio <= 1.0 ? 'text-green-600' : 'text-red-600'}">${V_ratio.toFixed(3)}</strong></p>
            </div>
        `;

        resultsContainer.innerHTML = `
            <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg">
                <h2 class="text-2xl font-bold text-center border-b pb-2">Detailed Calculation Report (ACI 318-19)</h2>
                <table class="w-full mt-4">
                    <caption>Design Checks</caption>
                    <thead><tr><th>Check</th><th>Demand</th><th>Capacity</th><th>Ratio</th><th>Status</th></tr></thead>
                    <tbody>
                        <tr>
                            <td>Flexure</td>
                            <td>${(inputs.Mu / 12000).toFixed(2)} kip-ft</td>
                            <td>${(results.phiMn / 12000).toFixed(2)} kip-ft</td>
                            <td>${M_ratio.toFixed(3)}</td>
                            <td>${getStatus(M_ratio)}</td>
                        </tr>
                        <tr>
                            <td>Shear</td>
                            <td>${(inputs.Vu / 1000).toFixed(2)} kips</td>
                            <td>${(results.phiVn / 1000).toFixed(2)} kips</td>
                            <td>${V_ratio.toFixed(3)}</td>
                            <td>${getStatus(V_ratio)}</td>
                        </tr>
                    </tbody>
                </table>
                <div class="calc-breakdown mt-4">
                    <h4>Flexure Breakdown</h4>
                    <ul>
                        <li>Effective Depth (d): ${results.d.toFixed(2)} in</li>
                        <li>Area of Steel (A<sub>s</sub>): ${results.As.toFixed(2)} in²</li>
                        <li>Depth of Compression Block (a): ${results.a.toFixed(2)} in</li>
                        <li>Neutral Axis Depth (c): ${results.c.toFixed(2)} in</li>
                        <li>Tensile Strain (&epsilon;<sub>t</sub>): ${results.strain_t.toFixed(4)} (${results.strain_t >= 0.005 ? 'Tension-Controlled' : 'Transition'})</li>
                        <li>Strength Reduction Factor (&phi;<sub>f</sub>): ${results.phi_f.toFixed(2)}</li>
                    </ul>
                </div>
                <div class="calc-breakdown mt-4">
                    <h4>Shear Breakdown</h4>
                    <ul>
                        <li>Concrete Capacity (V<sub>c</sub>): ${(results.Vc/1000).toFixed(2)} kips</li>
                        <li>Stirrup Capacity (V<sub>s</sub>): ${(results.Vs/1000).toFixed(2)} kips</li>
                        <li>Max Stirrup Capacity (V<sub>s,max</sub>): ${(results.Vs_max/1000).toFixed(2)} kips</li>
                    </ul>
                </div>
            </div>`;
    }
    </script>
</body>
</html>