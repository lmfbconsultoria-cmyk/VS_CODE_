<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ASCE Snow Load Calculator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script>
        // This script is in shared-utils.js, but needs to run early to prevent FOUC.
        (function() {
            const isDark = localStorage.getItem('color-theme') === 'dark' || (!('color-theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches);
            document.documentElement.classList.toggle('dark', isDark);
        })();
    </script>
    <link rel="stylesheet" href="../styles.min.css">
    <script src="../js/template.js" defer></script>
    <script src="../js/shared-utils.js" defer></script>
    <script src="../js/validation-rules.js" defer></script>
    <script src="snow.js" defer></script>
</head>
<body class="bg-gray-50 text-gray-800 dark:bg-gray-900 dark:text-gray-300">

    <div class="container mx-auto p-4 md:p-8 max-w-7xl">
        <div id="header-placeholder" style="min-height: 110px;"></div>

        <main id="snow-calculator-form">
             <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Column 1 -->
                <div class="space-y-6">
                    <div class="form-section">
                        <h2>Snow Load Diagrams</h2>
                        <div class="diagram">
                            <svg id="snow-diagram" viewBox="0 0 400 200" class="w-full h-auto" xmlns="http://www.w3.org/2000/svg">
                                <!-- High Roof -->
                                <rect x="20" y="80" width="130" height="100" class="svg-member" />
                                <!-- Low Roof -->
                                <rect x="150" y="120" width="230" height="60" class="svg-member" />
                                <!-- Roof Lines -->
                                <path d="M20 80 L 85 40 L 150 80" fill="none" class="svg-member" stroke-width="2"/>
                                
                                <!-- Balanced Load -->
                                <polygon points="20,78 85,38 150,78 150,70 85,30 20,70" fill="#a7f3d0" opacity="0.7" />
                                <text x="85" y="60" class="svg-label" font-size="12">Balanced</text>
                                <!-- Unbalanced Load -->
                                <polygon points="85,40 150,80 150,60 85,20" fill="#fde047" opacity="0.7" />
                                <text x="117" y="55" class="svg-label" font-size="12">Unbalanced</text>
                                <!-- Drift Load -->
                                <path d="M150 120 L 150 80 L 210 120 Z" fill="#fdba74" opacity="0.7" />
                                <text x="170" y="110" class="svg-label" font-size="12">Drift</text>
                            </svg>
                        </div>
                    </div>
                    <div class="form-section">
                        <h2>Building & Roof Properties</h2>
                        <div class="grid grid-cols-2 gap-4">
                             <div>
                                <label for="snow_surface_roughness_category" class="block text-sm font-medium mb-1">Surface Roughness</label>
                                <select id="snow_surface_roughness_category">
                                    <option value="B">B</option>
                                    <option value="C" selected>C</option>
                                    <option value="D">D</option>
                                    <option value="Above treeline (windswept)">Above treeline (windswept)</option>
                                    <option value="Alaska (no trees)">Alaska (no trees)</option>
                                </select>
                            </div>
                            <div>
                                <label for="snow_exposure_condition" class="block text-sm font-medium mb-1">Exposure</label>
                                <select id="snow_exposure_condition">
                                    <option>Fully Exposed</option>
                                    <option selected>Partially Exposed</option>
                                    <option>Sheltered</option>
                                </select>
                            </div>
                            <div>
                                <label for="snow_thermal_condition" class="block text-sm font-medium mb-1">Thermal Condition (Ct)</label>
                                <select id="snow_thermal_condition">
                                    <option>Heated Structure</option>
                                    <option selected>Unheated Structure</option>
                                </select>
                            </div>
                             <div>
                                <label for="snow_roof_type" class="block text-sm font-medium mb-1">Roof Type</label>
                                <select id="snow_roof_type">
                                    <option value="gable_hip" selected>Gable/Hip</option>
                                    <option value="monoslope">Monoslope</option>
                                    <option value="arched">Arched</option>
                                </select>
                            </div>
                            <div>
                                <label for="snow_roof_slope_degrees" class="block text-sm font-medium mb-1">Roof Slope (Â°)</label>
                                <input type="number" id="snow_roof_slope_degrees" value="10" min="0" max="90">
                            </div>
                            <div>
                                <label for="snow_is_roof_slippery" class="block text-sm font-medium mb-1">Slippery Roof?</label>
                                <select id="snow_is_roof_slippery" data-ui-toggle-controller data-ui-toggle-target="#sliding-snow-inputs" data-ui-toggle-condition-value="Yes">
                                    <option value="Yes">Yes</option>
                                    <option value="No" selected>No</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Column 2 -->
                <div class="space-y-6">
                    <div class="form-section">
                        <h2>General Parameters</h2>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label for="snow_asce_standard" class="block text-sm font-medium mb-1">ASCE Standard</label>
                                <select id="snow_asce_standard">
                                    <option value="ASCE 7-16" selected>ASCE 7-16</option>
                                    <option value="ASCE 7-22">ASCE 7-22</option>
                                </select>
                            </div>
                            <div>
                                <label for="snow_unit_system" class="block text-sm font-medium mb-1">Unit System</label>
                                <select id="snow_unit_system">
                                    <option value="imperial" selected>Imperial (psf, ft)</option>
                                    <option value="metric">Metric (kPa, m)</option>
                                </select>
                            </div>
                            <div>
                                <label for="snow_risk_category" class="block text-sm font-medium mb-1">Risk Category</label>
                                <select id="snow_risk_category">
                                    <option value="I">I</option>
                                    <option value="II" selected>II</option>
                                    <option value="III">III</option>
                                    <option value="IV">IV</option>
                                </select>
                            </div>
                            <div>
                                <label for="snow_design_method" class="block text-sm font-medium mb-1">Design Method</label>
                                <select id="snow_design_method">
                                    <option value="ASD" selected>ASD</option>
                                    <option value="LRFD">LRFD</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="form-section">
                         <h2>Additional Load Cases</h2>
                          <div class="space-y-4">
                            <div>
                                <label for="snow_calculate_unbalanced" class="block text-sm font-medium mb-1">Calculate Unbalanced Load?</label>
                                <select id="snow_calculate_unbalanced">
                                    <option value="Yes">Yes</option>
                                    <option value="No" selected>No</option>
                                </select>
                            </div>
                            <div>
                                <label for="snow_calculate_drift" class="block text-sm font-medium mb-1">Calculate Drift Load?</label>
                                <select id="snow_calculate_drift">
                                    <option value="Yes">Yes</option>
                                    <option value="No" selected>No</option>
                                </select>
                            </div>
                            <div>
                                <label for="snow_calculate_sliding" class="block text-sm font-medium mb-1">Calculate Sliding Snow?</label>
                                <select id="snow_calculate_sliding">
                                    <option value="Yes">Yes</option>
                                    <option value="No" selected>No</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Column 3 -->
                <div class="space-y-6">
                    <div class="form-section">
                        <h2>Jurisdiction & Site</h2>
                         <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label for="snow_jurisdiction" class="block text-sm font-medium mb-1">Jurisdiction</label>
                                <select id="snow_jurisdiction">
                                    <option value="ASCE 7" selected>ASCE 7</option>
                                    <option value="NYCBC 2022">NYCBC 2022</option>
                                </select>
                            </div>
                            <div>
                                <label for="snow_nycbc_minimum_roof_snow_load" class="block text-sm font-medium mb-1">NYCBC Min. Load (psf)</label>
                                <input type="number" id="snow_nycbc_minimum_roof_snow_load" value="20">
                            </div>
                            <div>
                                <label for="snow_ground_snow_load" class="block text-sm font-medium mb-1">Ground Snow Load (pg)</label>
                                <input type="number" id="snow_ground_snow_load" value="25" min="0">
                            </div>
                         </div>
                    </div>
                    <div class="form-section">
                         <h2>Unbalanced & Drift Parameters</h2>
                         <div class="grid grid-cols-2 gap-4">
                             <div>
                                <label for="snow_eave_to_ridge_distance_W" class="block text-sm font-medium mb-1">Eave-to-Ridge (W)</label>
                                <input type="number" id="snow_eave_to_ridge_distance_W" value="25">
                            </div>
                            <div>
                                <label for="snow_is_simply_supported_prismatic" class="block text-sm font-medium mb-1">Simply Supported?</label>
                                <select id="snow_is_simply_supported_prismatic">
                                    <option value="Yes">Yes</option>
                                    <option value="No" selected>No</option>
                                </select>
                            </div>
                             <div>
                                <label for="snow_winter_wind_parameter_W2" class="block text-sm font-medium mb-1">Winter Wind (Wâ)</label>
                                <input type="number" id="snow_winter_wind_parameter_W2" value="0.55">
                            </div>
                            <div>
                                <label for="snow_upper_roof_length_lu" class="block text-sm font-medium mb-1">Upper Roof L (lu)</label>
                                <input type="number" id="snow_upper_roof_length_lu" value="30">
                            </div>
                            <div>
                                <label for="snow_height_difference_hc" class="block text-sm font-medium mb-1">Height Diff (hc)</label>
                                <input type="number" id="snow_height_difference_hc" value="10">
                            </div>
                            <div>
                                <label for="snow_lower_roof_length_ll" class="block text-sm font-medium mb-1">Lower Roof L (ll)</label>
                                <input type="number" id="snow_lower_roof_length_ll" value="30">
                            </div>
                         </div>
                    </div>
                </div>
    </div> <!-- This was the missing closing div -->
    <div class="lg:col-span-3 mt-8 flex justify-center items-center gap-4 flex-wrap">
        <button id="load-snow-inputs-btn" class="bg-gray-500 text-white font-bold py-3 px-6 rounded-lg hover:bg-gray-600">Load Inputs</button>
        <button id="save-snow-inputs-btn" class="bg-green-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-green-700">Save Inputs</button>
        <span id="file-name-display" class="text-sm text-gray-500 dark:text-gray-400"></span>
        <button id="run-snow-calculation-btn" class="bg-blue-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-4 focus:ring-blue-300 transition-all duration-300 transform hover:scale-105">Run Snow Load Calculation</button>
        <input type="file" id="snow-file-input" class="hidden" accept=".txt">
    </div>
        </main>

        <div id="feedback-message" class="text-center mt-2 text-sm h-5"></div>
        <div id="snow-results-container" class="mt-10 results-container"></div>
        
        <div id="footer-placeholder"></div>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            injectHeader({
                activePage: 'snow',
                pageTitle: 'ASCE Snow Load Calculator',
                headerPlaceholderId: 'header-placeholder'
            });
            injectFooter({
                footerPlaceholderId: 'footer-placeholder'
            });
        });
    </script>
</body>
</html>