<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ASCE Rain Load Calculator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script>
        // This script is in shared-utils.js, but needs to run early to prevent FOUC.
        (function() {
            const isDark = localStorage.getItem('color-theme') === 'dark' || (!('color-theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches);
            document.documentElement.classList.toggle('dark', isDark);
        })();
    </script>
    <link rel="stylesheet" href="../styles.min.css">
    <script src="../js/template.js" defer></script>
    <script src="../js/shared-utils.js" defer></script>
    <script src="../js/validation-rules.js" defer></script>
    <script src="rain.js" defer></script>
</head>
<body class="bg-gray-50 text-gray-800 dark:bg-gray-900 dark:text-gray-300">

    <div class="container mx-auto p-4 md:p-8 max-w-7xl">
        <div id="header-placeholder" style="min-height: 110px;"></div>

        <main id="rain-calculator-form">
             <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Column 1 -->
                <div class="space-y-6">
                    <div class="form-section">
                        <h2>Rain Load Diagram</h2>
                        <div class="diagram">
                            <svg id="rain-diagram" viewBox="0 0 400 200" class="w-full h-auto" xmlns="http://www.w3.org/2000/svg"><rect x="50" y="150" width="300" height="10" class="svg-member"/><rect x="175" y="100" width="50" height="50" fill="none" stroke="#9ca3af" stroke-dasharray="2 2"/><path d="M50 100 L350 100" stroke="#60a5fa" stroke-width="2"/><text x="200" y="90" class="svg-label">Ponded Water</text><line x1="150" y1="100" x2="150" y2="150" class="svg-dim"/><text x="135" y="125" class="svg-dim-text" transform="rotate(-90 135,125)">d_s</text><line x1="250" y1="80" x2="250" y2="100" class="svg-dim"/><text x="260" y="90" class="svg-dim-text">d_h</text></svg>
                        </div>
                    </div>
                </div>
                <!-- Column 2 -->
                <div class="space-y-6">
                    <div class="form-section">
                        <h2>General Parameters</h2>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label for="rain_asce_standard" class="block text-sm font-medium mb-1">ASCE Standard</label>
                                <select id="rain_asce_standard">
                                    <option value="ASCE 7-16" selected>ASCE 7-16</option>
                                    <option value="ASCE 7-22">ASCE 7-22</option>
                                </select>
                            </div>
                            <div>
                                <label for="rain_unit_system" class="block text-sm font-medium mb-1">Unit System</label>
                                <select id="rain_unit_system">
                                    <option value="imperial" selected>Imperial (in, psf)</option>
                                    <option value="metric">Metric (mm, kPa)</option>
                                </select>
                            </div>
                             <div>
                                <label for="rain_design_method" class="block text-sm font-medium mb-1">Design Method</label>
                                <select id="rain_design_method">
                                    <option value="ASD" selected>ASD</option>
                                    <option value="LRFD">LRFD</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="form-section">
                        <h2>Drainage System</h2>
                        <div class="flex items-center mb-4">
                            <label for="dh_auto_calc_toggle" class="text-sm font-medium mr-3">Calculate d<sub>h</sub> automatically?</label>
                            <input type="checkbox" id="dh_auto_calc_toggle" class="h-5 w-5 rounded" checked
                                   data-ui-toggle-controller
                                   data-ui-toggle-target="#dh_auto_calc_container"
                                   data-ui-toggle-type="visibility">
                        </div>
                        <div id="dh_auto_calc_container" class="space-y-4">
                             <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label for="rain_drain_type" class="block text-sm font-medium mb-1">Secondary Drain Type</label>
                                    <select id="rain_drain_type"
                                            data-ui-toggle-controller>
                                        <option value="scupper" selected>Scupper</option>
                                        <option value="drain">Roof Drain</option>
                                    </select>
                                </div>
                                <div id="scupper_inputs_container">
                                    <div id="scupper_inputs">
                                        <label for="rain_scupper_width" class="block text-sm font-medium mb-1">Scupper Width (L)</label>
                                        <input type="number" id="rain_scupper_width" value="12"
                                               data-ui-toggle-target-for="rain_drain_type" data-ui-toggle-condition-value="scupper">
                                    </div>
                                </div>
                                <div id="drain_inputs_container" class="hidden">
                                    <div id="drain_inputs">
                                        <label for="rain_drain_diameter" class="block text-sm font-medium mb-1">Drain Diameter (d)</label>
                                        <input type="number" id="rain_drain_diameter" value="4"
                                               data-ui-toggle-target-for="rain_drain_type" data-ui-toggle-condition-value="drain">
                                    </div>
                                </div>
                            </div>
                        </div>
                        <p class="text-xs text-gray-500 dark:text-gray-400 mt-4">
                            Note: The rainfall intensity (i) is used to calculate the hydraulic head (d<sub>h</sub>) based on the roof's tributary area and secondary drainage system capacity, per ASCE 7 and the International Plumbing Code.
                        </p>
                    </div>
                </div>
                <!-- Column 3 -->
                <div class="space-y-6">
                    <div class="form-section">
                        <h2>Drainage Calculation Parameters</h2>
                        <div class="grid grid-cols-2 gap-4">
                             <div>
                                <label for="rain_jurisdiction" class="block text-sm font-medium mb-1">Jurisdiction</label>
                                <select id="rain_jurisdiction">
                                    <option value="ASCE 7" selected>ASCE 7</option>
                                    <option value="NYCBC 2022">NYCBC 2022</option>
                                </select>
                            </div>
                            <div>
                                <label for="rain_tributary_area" class="block text-sm font-medium mb-1">Tributary Area (A)</label>
                                <input type="number" id="rain_tributary_area" value="1000">
                            </div>
                            <div>
                                <label for="rain_intensity" class="block text-sm font-medium mb-1">Rainfall Intensity (i)</label>
                                <input type="number" id="rain_intensity" value="4.0">
                            </div>
                            <div>
                                <label for="rain_city_selector" class="block text-sm font-medium mb-1">Select City (for intensity)</label>
                                <select id="rain_city_selector">
                                    <option value="">-- Select a City --</option>
                                    <option value="4.0">New York, NY</option>
                                    <option value="3.5">Los Angeles, CA</option>
                                    <option value="4.2">Chicago, IL</option>
                                    <option value="5.5">Houston, TX</option>
                                    <option value="3.8">Phoenix, AZ</option>
                                    <option value="3.9">Philadelphia, PA</option>
                                    <option value="4.5">Miami, FL</option>
                                </select>
                            </div>
                            <div>
                                <label for="rain_static_head" class="block text-sm font-medium mb-1">Static Head (ds)</label>
                                <input type="number" id="rain_static_head" value="2.0">
                            </div>
                            <div id="dh_manual_input_container_wrapper" class="hidden">
                                <div id="dh_manual_input_container"
                                     data-ui-toggle-controller
                                     data-ui-toggle-target-for="dh_auto_calc_toggle"
                                     data-ui-toggle-invert="true">
                                    <label for="rain_hydraulic_head" class="block text-sm font-medium mb-1">Hydraulic Head (dh)</label>
                                    <input type="number" id="rain_hydraulic_head" value="1.0">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
    </div>
    <div class="lg:col-span-3 mt-8 flex justify-center">
        <button id="load-rain-inputs-btn" class="bg-gray-500 text-white font-bold py-3 px-6 rounded-lg hover:bg-gray-600 mr-4">Load Inputs</button>
        <button id="save-rain-inputs-btn" class="bg-green-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-green-700 mr-4">Save Inputs</button>
        <span id="file-name-display" class="text-sm text-gray-500 dark:text-gray-400"></span>
        <button id="run-rain-calculation-btn" class="bg-blue-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-4 focus:ring-blue-300 transition-all duration-300 transform hover:scale-105">Run Rain Load Calculation</button>
        <input type="file" id="rain-file-input" class="hidden" accept=".txt">
    </div>
        </div>
        </main>

        <div id="feedback-message" class="text-center mt-2 text-sm h-5"></div>
        <div id="rain-results-container" class="mt-10 results-container"></div>
        
        <div id="footer-placeholder"></div>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            injectHeader({
                activePage: 'rain',
                pageTitle: 'ASCE Rain Load Calculator',
                headerPlaceholderId: 'header-placeholder'
            });
            injectFooter({
                footerPlaceholderId: 'footer-placeholder'
            });
        });
    </script>
</body>
</html>